{"ts":1349272427116,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1349272526108,"patch":[[{"diffs":[[1,"(function(a){var b,c=a.documentMode;b=\"onhashchange\"in a&&(void 0===c||7<c);L.Hash=function(a){this.onHashChange=L.Util.bind(this.onHashChange,this);a&&this.init(a)};L.Hash.prototype={map:null,lastHash:null,parseHash:function(a){0==a.indexOf(\"#\")&&(a=a.substr(1));var b=a.split(\"/\");if(3==b.length){var a=parseInt(b[0],10),c=parseFloat(b[1]),b=parseFloat(b[2]);return isNaN(a)||isNaN(c)||isNaN(b)?!1:{center:new L.LatLng(c,b),zoom:a}}return!1},formatHash:function(a){var b=a.getCenter(),a=a.getZoom(),\r\nc=Math.max(0,Math.ceil(Math.log(a)/Math.LN2));return\"#\"+[a,b.lat.toFixed(c),b.lng.toFixed(c)].join(\"/\")},init:function(a){this.map=a;this.map.on(\"moveend\",this.onMapMove,this);this.lastHash=null;this.onHashChange();this.isListening||this.startListening()},remove:function(){this.map=null;this.isListening&&this.stopListening()},onMapMove:function(){if(this.movingMap||0===this.map.getZoom())return!1;var a=this.formatHash(this.map);this.lastHash!=a&&(location.replace(a),this.lastHash=a)},movingMap:!1,\r\nupdate:function(){var a=location.hash;if(a!==this.lastHash)if(a=this.parseHash(a))this.movingMap=!0,this.map.setView(a.center,a.zoom),this.movingMap=!1;else this.onMapMove(this.map)},changeDefer:100,changeTimeout:null,onHashChange:function(){if(!this.changeTimeout){var a=this;this.changeTimeout=setTimeout(function(){a.update();a.changeTimeout=null},this.changeDefer)}},isListening:!1,hashChangeInterval:null,startListening:function(){b?L.DomEvent.addListener(a,\"hashchange\",this.onHashChange):(clearInterval(this.hashChangeInterval),\r\nthis.hashChangeInterval=setInterval(this.onHashChange,50));this.isListening=!0},stopListening:function(){b?L.DomEvent.removeListener(a,\"hashchange\",this.onHashChange):clearInterval(this.hashChangeInterval);this.isListening=!1}}})(window);(function(){L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,skipDuplicateAddTesting:!1,animateAddingMarkers:!1},initialize:function(a){L.Util.setOptions(this,a);this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction);L.FeatureGroup.prototype.initialize.call(this,[]);this._inZoomAnimation=0;this._needsClustering=\r\n[];this._currentShownBounds=null},addLayer:function(a){if(a instanceof L.LayerGroup){for(var b in a._layers)a._layers.hasOwnProperty(b)&&this.addLayer(a._layers[b]);return this}this.options.singleMarkerMode&&(a.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[a]}}));if(!this._map)return this._needsClustering.push(a),this;if(!this.options.skipDuplicateAddTesting&&this.hasLayer(a))return this;this._unspiderfy&&this._unspiderfy();this._addLayer(a,\r\nthis._maxZoom);b=a;var c=this._map.getZoom();if(a.__parent)for(;b.__parent._zoom>=c;)b=b.__parent;this.options.animateAddingMarkers?this._animationAddLayer(a,b):this._animationAddLayerNonAnimated(a,b);return this},removeLayer:function(a){if(!this._map)return this._arraySplice(this._needsClustering,a),this;if(!a.__parent)return this;this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(a));this._removeLayer(a,!0);a._icon&&(L.FeatureGroup.prototype.removeLayer.call(this,a),a.setOpacity(1));return this},\r\nclearLayers:function(){if(!this._map)return this._needsClustering=[],this;this._unspiderfy&&this._unspiderfy();for(var a in this._layers)this._layers.hasOwnProperty(a)&&L.FeatureGroup.prototype.removeLayer.call(this,this._layers[a]);this._generateInitialClusters();return this},hasLayer:function(a){var b=!1;this._topClusterLevel._recursively(new L.LatLngBounds([a.getLatLng()]),0,this._map.getMaxZoom()+1,function(c){for(var e=c._markers.length-1;0<=e&&!b;e--)c._markers[e]===a&&(b=!0)},null);return b},\r\nzoomToShowLayer:function(a,b){var c=function(){if((a._icon||a.__parent._icon)&&!this._inZoomAnimation)if(this._map.off(\"moveend\",c,this),this.off(\"animationend\",c,this),a._icon)b();else if(a.__parent._icon){var e=function(){this.off(\"spiderfied\",e,this);b()};this.on(\"spiderfied\",e,this);a.__parent.spiderfy()}};a._icon?b():a.__parent._zoom<this._map.getZoom()?(this._map.on(\"moveend\",c,this),a._icon||this._map.panTo(a.getLatLng())):(this._map.on(\"moveend\",c,this),this.on(\"animationend\",c,this),this._map.setView(a.getLatLng(),\r\na.__parent._zoom+1),a.__parent.zoomToBounds())},onAdd:function(a){L.FeatureGroup.prototype.onAdd.call(this,a);this._gridClusters||this._generateInitialClusters();for(var a=0,b=this._needsClustering.length;a<b;a++)this._addLayer(this._needsClustering[a],this._maxZoom);this._needsClustering=[];this._map.on(\"zoomend\",this._zoomEnd,this);this._map.on(\"moveend\",this._moveEnd,this);this._spiderfierOnAdd&&this._spiderfierOnAdd();this._bindEvents();this._zoom=this._map.getZoom();this._currentShownBounds=\r\nthis._getExpandedVisibleBounds();this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)},onRemove:function(a){this._map.off(\"zoomend\",this._zoomEnd,this);this._map.off(\"moveend\",this._moveEnd,this);this._map._mapPane.className=this._map._mapPane.className.replace(\" leaflet-cluster-anim\",\"\");this._spiderfierOnRemove&&this._spiderfierOnRemove();L.FeatureGroup.prototype.onRemove.call(this,a)},_arraySplice:function(a,b){for(var c=a.length-1;0<=c;c--)if(a[c]===b){a.splice(c,\r\n1);break}},_removeLayer:function(a,b){var c=this._gridClusters,e=this._gridUnclustered,g=this._map;if(b)for(var d=this._maxZoom;0<=d&&e[d].removeObject(a,g.project(a.getLatLng(),d));d--);var d=a.__parent,f;for(this._arraySplice(d._markers,a);d;){d._childCount--;if(0>d._zoom)break;else b&&1>=d._childCount?(f=d._markers[0]===a?d._markers[1]:d._markers[0],c[d._zoom].removeObject(d,g.project(d._cLatLng,d._zoom)),e[d._zoom].addObject(f,g.project(f.getLatLng(),d._zoom)),this._arraySplice(d.__parent._childClusters,\r\nd),d.__parent._markers.push(f),f.__parent=d.__parent,d._icon&&(L.FeatureGroup.prototype.removeLayer.call(this,d),L.FeatureGroup.prototype.addLayer.call(this,f))):(d._recalculateBounds(),d._updateIcon());d=d.__parent}},_propagateEvent:function(a){a.target instanceof L.MarkerCluster&&(a.type=\"cluster\"+a.type);L.FeatureGroup.prototype._propagateEvent.call(this,a)},_defaultIconCreateFunction:function(a){var a=a.getChildCount(),b=\" marker-cluster-\";return new L.DivIcon({html:\"<div><span>\"+a+\"</span></div>\",\r\nclassName:\"marker-cluster\"+(10>a?b+\"small\":100>a?b+\"medium\":b+\"large\"),iconSize:new L.Point(40,40)})},_bindEvents:function(){var a=null,b=this._map,c=this.options.spiderfyOnMaxZoom,e=this.options.showCoverageOnHover,g=this.options.zoomToBoundsOnClick;if(c||g)this.on(\"clusterclick\",function(a){b.getMaxZoom()===b.getZoom()?c&&a.layer.spiderfy():g&&a.layer.zoomToBounds()},this);e&&(this.on(\"clustermouseover\",function(c){this._inZoomAnimation||(a&&b.removeLayer(a),2<c.layer.getChildCount()&&(a=new L.Polygon(c.layer.getConvexHull()),\r\nb.addLayer(a)))},this),this.on(\"clustermouseout\",function(){a&&(b.removeLayer(a),a=null)},this),b.on(\"zoomend\",function(){a&&(b.removeLayer(a),a=null)},this),b.on(\"layerremove\",function(c){a&&c.layer===this&&(b.removeLayer(a),a=null)},this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=this._map._zoom,this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var a=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,\r\nthis._zoom,a);this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,a);this._currentShownBounds=a}},_generateInitialClusters:function(){var a=this._map.getMaxZoom(),b=this.options.maxClusterRadius;this.options.disableClusteringAtZoom&&(a=this.options.disableClusteringAtZoom-1);this._maxZoom=a;this._gridClusters={};for(this._gridUnclustered={};0<=a;a--)this._gridClusters[a]=new L.DistanceGrid(b),this._gridUnclustered[a]=new L.DistanceGrid(b);this._topClusterLevel=new L.MarkerCluster(this,\r\n-1)},_addLayer:function(a,b){for(var c=this._gridClusters,e=this._gridUnclustered,g,d;0<=b;b--){g=this._map.project(a.getLatLng(),b);var f=c[b].getNearObject(g);if(f){f._addChild(a);a.__parent=f;return}if(f=e[b].getNearObject(g)){f.__parent&&this._removeLayer(f,!1);g=f.__parent;d=new L.MarkerCluster(this,b,f,a);c[b].addObject(d,this._map.project(d._cLatLng,b));f.__parent=d;var i=a.__parent=d;for(d=b-1;d>g._zoom;d--)i=new L.MarkerCluster(this,d,i),c[d].addObject(i,this._map.project(f.getLatLng(),d));\r\ng._addChild(i);for(d=b;0<=d&&e[d].removeObject(f,this._map.project(f.getLatLng(),d));d--);return}e[b].addObject(a,g)}this._topClusterLevel._addChild(a);a.__parent=this._topClusterLevel},_mergeSplitClusters:function(){this._zoom<this._map._zoom?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,this._map._zoom)):this._zoom>this._map._zoom?(this._animationStart(),this._animationZoomOut(this._zoom,\r\nthis._map._zoom)):this._moveEnd()},_getExpandedVisibleBounds:function(){var a=this._map,b=a.getPixelBounds(),c=L.Browser.mobile?0:Math.abs(b.max.x-b.min.x),e=L.Browser.mobile?0:Math.abs(b.max.y-b.min.y),g=a.unproject(new L.Point(b.min.x-c,b.min.y-e)),a=a.unproject(new L.Point(b.max.x+c,b.max.y+e));return new L.LatLngBounds(g,a)},_animationAddLayerNonAnimated:function(a,b){if(b===a)L.FeatureGroup.prototype.addLayer.call(this,a);else if(2===b._childCount){b._addToMap();var c=b.getAllChildMarkers();\r\nL.FeatureGroup.prototype.removeLayer.call(this,c[0]);L.FeatureGroup.prototype.removeLayer.call(this,c[1])}else b._updateIcon()}});L.MarkerClusterGroup.include(!L.DomUtil.TRANSITION?{_animationStart:function(){},_animationZoomIn:function(a,b){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,a);this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds())},_animationZoomOut:function(a,b){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,\r\na);this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds())},_animationAddLayer:function(a,b){this._animationAddLayerNonAnimated(a,b)}}:{_animationStart:function(){this._map._mapPane.className+=\" leaflet-cluster-anim\";this._inZoomAnimation++},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(\" leaflet-cluster-anim\",\"\"));this._inZoomAnimation--;this.fire(\"animationend\")},_animationZoomIn:function(a,b){var c=this,\r\ne=this._getExpandedVisibleBounds(),g;this._topClusterLevel._recursively(e,a,0,function(d){var f=d._latlng,j=d._markers;d._isSingleParent()&&a+1===b?(L.FeatureGroup.prototype.removeLayer.call(c,d),d._recursivelyAddChildrenToMap(null,b,e)):(d.setOpacity(0),d._recursivelyAddChildrenToMap(f,b,e));for(g=j.length-1;0<=g;g--)d=j[g],e.contains(d._latlng)||L.FeatureGroup.prototype.removeLayer.call(c,d)});this._forceLayout();var d,f;c._topClusterLevel._recursivelyBecomeVisible(e,b);for(d in c._layers)c._layers.hasOwnProperty(d)&&\r\n(f=c._layers[d],!(f instanceof L.MarkerCluster)&&f._icon&&f.setOpacity(1));c._topClusterLevel._recursively(e,a,b,function(a){a._recursivelyRestoreChildPositions(b)});setTimeout(function(){c._topClusterLevel._recursively(e,a,0,function(a){L.FeatureGroup.prototype.removeLayer.call(c,a);a.setOpacity(1)});c._animationEnd()},250)},_animationZoomOut:function(a,b){this._animationZoomOutSingle(this._topClusterLevel,a-1,b);this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds());\r\nthis._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,a,this._getExpandedVisibleBounds())},_animationZoomOutSingle:function(a,b,c){var e=this._getExpandedVisibleBounds();a._recursivelyAnimateChildrenInAndAddSelfToMap(e,b+1,c);var g=this;this._forceLayout();a._recursivelyBecomeVisible(e,c);setTimeout(function(){if(1===a._childCount){var d=a._markers[0];d.setLatLng(d.getLatLng());d.setOpacity(1)}else a._recursively(e,c,0,function(a){a._recursivelyRemoveChildrenFromMap(e,b+\r\n1)}),g._animationEnd()},250)},_animationAddLayer:function(a,b){var c=this;L.FeatureGroup.prototype.addLayer.call(this,a);b!==a&&(2<b._childCount?(b._updateIcon(),this._forceLayout(),this._animationStart(),a._setPos(this._map.latLngToLayerPoint(b.getLatLng())),a.setOpacity(0),setTimeout(function(){L.FeatureGroup.prototype.removeLayer.call(c,a);a.setOpacity(1);c._animationEnd()},250)):(this._forceLayout(),c._animationStart(),c._animationZoomOutSingle(b,this._map.getMaxZoom(),this._map.getZoom())))},\r\n_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}});L.MarkerCluster=L.Marker.extend({initialize:function(a,b,c,e){L.Marker.prototype.initialize.call(this,c?c._cLatLng||c.getLatLng():new L.LatLng(0,0),{icon:this});this._group=a;this._zoom=b;this._markers=[];this._childClusters=[];this._childCount=0;this._iconNeedsUpdate=!0;this._bounds=new L.LatLngBounds;c&&this._addChild(c);e&&this._addChild(e)},getAllChildMarkers:function(a){for(var a=a||[],b=this._childClusters.length-1;0<=b;b--)this._childClusters[b].getAllChildMarkers(a);\r\nfor(b=this._markers.length-1;0<=b;b--)a.push(this._markers[b]);return a},getChildCount:function(){return this._childCount},zoomToBounds:function(){this._group._map.fitBounds(this._bounds)},_updateIcon:function(){this._iconNeedsUpdate=!0;this._icon&&this.setIcon(this)},createIcon:function(){this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1);return this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(a,\r\nb){this._iconNeedsUpdate=!0;this._expandBounds(a);a instanceof L.MarkerCluster?(b||(this._childClusters.push(a),a.__parent=this),this._childCount+=a._childCount):(b||this._markers.push(a),this._childCount++);this.__parent&&this.__parent._addChild(a,!0)},_expandBounds:function(a){var b,c=a._wLatLng||a._latlng;a instanceof L.MarkerCluster?(this._bounds.extend(a._bounds),b=a._childCount):(this._bounds.extend(c),b=1);this._cLatLng||(this._cLatLng=a._cLatLng||c);a=this._childCount+b;this._wLatLng?(this._wLatLng.lat=\r\n(c.lat*b+this._wLatLng.lat*this._childCount)/a,this._wLatLng.lng=(c.lng*b+this._wLatLng.lng*this._childCount)/a):this._latlng=this._wLatLng=new L.LatLng(c.lat,c.lng)},_addToMap:function(a){a&&(this._backupLatlng=this._latlng,this.setLatLng(a));L.FeatureGroup.prototype.addLayer.call(this._group,this)},_recursivelyAnimateChildrenIn:function(a,b,c){this._recursively(a,0,c-1,function(a){var a=a._markers,c,d;for(c=a.length-1;0<=c;c--)d=a[c],d._icon&&(d._setPos(b),d.setOpacity(0))},function(a){var a=a._childClusters,\r\nc,d;for(c=a.length-1;0<=c;c--)d=a[c],d._icon&&(d._setPos(b),d.setOpacity(0))})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(a,b,c){this._recursively(a,c,0,function(e){e._recursivelyAnimateChildrenIn(a,e._group._map.latLngToLayerPoint(e.getLatLng()).round(),b);e._isSingleParent()&&b-1===c?(e.setOpacity(1),e._recursivelyRemoveChildrenFromMap(a,b)):e.setOpacity(0);e._addToMap()})},_recursivelyBecomeVisible:function(a,b){this._recursively(a,0,b,null,function(a){a.setOpacity(1)})},_recursivelyAddChildrenToMap:function(a,\r\nb,c){this._recursively(c,-1,b,function(e){if(b!==e._zoom)for(var g=e._markers.length-1;0<=g;g--){var d=e._markers[g];c.contains(d._latlng)&&(a&&(d._backupLatlng=d.getLatLng(),d.setLatLng(a),d.setOpacity(0)),L.FeatureGroup.prototype.addLayer.call(e._group,d))}},function(b){b._addToMap(a)})},_recursivelyRestoreChildPositions:function(a){for(var b=this._markers.length-1;0<=b;b--){var c=this._markers[b];c._backupLatlng&&(c.setLatLng(c._backupLatlng),delete c._backupLatlng)}if(a-1===this._zoom)for(a=this._childClusters.length-\r\n1;0<=a;a--)this._childClusters[a]._restorePosition();else for(b=this._childClusters.length-1;0<=b;b--)this._childClusters[b]._recursivelyRestoreChildPositions(a)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(a,b,c){var e,g;this._recursively(a,-1,b-1,function(a){for(g=a._markers.length-1;0<=g;g--)if(e=a._markers[g],!c||!c.contains(e._latlng))L.FeatureGroup.prototype.removeLayer.call(a._group,\r\ne),e.setOpacity(1)},function(a){for(g=a._childClusters.length-1;0<=g;g--)if(e=a._childClusters[g],!c||!c.contains(e._latlng))L.FeatureGroup.prototype.removeLayer.call(a._group,e),e.setOpacity(1)})},_recursively:function(a,b,c,e,g){var d=this._childClusters,f=this._zoom,i;if(b>f)for(f=d.length-1;0<=f;f--)i=d[f],a.intersects(i._bounds)&&i._recursively(a,b,c,e,g);else if(e&&e(this),g&&this._zoom===c&&g(this),c>f)for(f=d.length-1;0<=f;f--)i=d[f],a.intersects(i._bounds)&&i._recursively(a,b,c,e,g)},_recalculateBounds:function(){var a=\r\nthis._markers,b=this._childClusters,c;this._bounds=new L.LatLngBounds;delete this._wLatLng;for(c=a.length-1;0<=c;c--)this._expandBounds(a[c]);for(c=b.length-1;0<=c;c--)this._expandBounds(b[c])},_isSingleParent:function(){return 0<this._childClusters.length&&this._childClusters[0]._childCount===this._childCount}});L.DistanceGrid=function(a){this._cellSize=a;this._sqCellSize=a*a;this._grid={};this._objectPoint={}};L.DistanceGrid.prototype={addObject:function(a,b){var c=this._getCoord(b.x),e=this._getCoord(b.y),\r\ng=this._grid,e=g[e]=g[e]||{},c=e[c]=e[c]||[],e=L.Util.stamp(a);this._objectPoint[e]=b;c.push(a)},updateObject:function(a,b){this.removeObject(a);this.addObject(a,b)},removeObject:function(a,b){var c=this._getCoord(b.x),e=this._getCoord(b.y),g=this._grid,e=g[e]=g[e]||{},g=e[c]=e[c]||[],d,f;delete this._objectPoint[L.Util.stamp(a)];d=0;for(f=g.length;d<f;d++)if(g[d]===a)return g.splice(d,1),1===f&&delete e[c],!0},eachObject:function(a,b){var c,e,g,d,f,i,k,j=this._grid;for(c in j)if(j.hasOwnProperty(c))for(e in f=\r\nj[c],f)if(f.hasOwnProperty(e)){i=f[e];g=0;for(d=i.length;g<d;g++)if(k=a.call(b,i[g]))g--,d--}},getNearObject:function(a){var b=this._getCoord(a.x),c=this._getCoord(a.y),e,g,d,f,i,k,j,l,q=this._objectPoint,n=this._sqCellSize,p=null;for(e=c-1;e<=c+1;e++)if(f=this._grid[e])for(g=b-1;g<=b+1;g++)if(i=f[g]){d=0;for(k=i.length;d<k;d++)j=i[d],l=this._sqDist(q[L.Util.stamp(j)],a),l<n&&(n=l,p=j)}return p},_getCoord:function(a){return Math.floor(a/this._cellSize)},_sqDist:function(a,b){var c=b.x-a.x,e=b.y-a.y;\r\nreturn c*c+e*e}};L.QuickHull={getDistant:function(a,b){return(b[0].lng-b[1].lng)*(a.lat-b[0].lat)+(b[1].lat-b[0].lat)*(a.lng-b[0].lng)},findMostDistantPointFromBaseLine:function(a,b){var c=0,e=null,g=[],d,f,i;for(d=b.length-1;0<=d;d--)f=b[d],i=this.getDistant(f,a),0<i&&(g.push(f),i>c&&(c=i,e=f));return{maxPoint:e,newPoints:g}},buildConvexHull:function(a,b){var c=[],e=this.findMostDistantPointFromBaseLine(a,b);return e.maxPoint?(c=c.concat(this.buildConvexHull([a[0],e.maxPoint],e.newPoints)),c=c.concat(this.buildConvexHull([e.maxPoint,\r\na[1]],e.newPoints))):[a]},getConvexHull:function(a){var b=!1,c=!1,e=null,g=null,d;for(d=a.length-1;0<=d;d--){var f=a[d];if(!1===b||f.lat>b)e=f,b=f.lat;if(!1===c||f.lat<c)g=f,c=f.lat}return[].concat(this.buildConvexHull([g,e],a),this.buildConvexHull([e,g],a))}};L.MarkerCluster.include({getConvexHull:function(){var a=this.getAllChildMarkers(),b=[],c=[],e,g;for(g=a.length-1;0<=g;g--)e=a[g].getLatLng(),b.push(e);a=L.QuickHull.getConvexHull(b);for(g=a.length-1;0<=g;g--)c.push(a[g][0]);return c}});L.MarkerCluster.include({_2PI:2*\r\nMath.PI,_circleFootSeparation:25,_circleStartAngle:Math.PI/6,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(!(this._group._spiderfied===this||this._group._inZoomAnimation)){var a=this.getAllChildMarkers(),b=this._group._map.latLngToLayerPoint(this._latlng);this._group._unspiderfy();this._group._spiderfied=this;a.length>=this._circleSpiralSwitchover?b=this._generatePointsSpiral(a.length,b):(b.y+=10,b=this._generatePointsCircle(a.length,\r\nb));this._animationSpiderfy(a,b)}},unspiderfy:function(a){this._group._inZoomAnimation||(this._animationUnspiderfy(a),this._group._spiderfied=null)},_generatePointsCircle:function(a,b){var c=this._circleFootSeparation*(2+a)/this._2PI,e=this._2PI/a,g=[],d,f;g.length=a;for(d=a-1;0<=d;d--)f=this._circleStartAngle+d*e,g[d]=(new L.Point(b.x+c*Math.cos(f),b.y+c*Math.sin(f)))._round();return g},_generatePointsSpiral:function(a,b){var c=this._spiralLengthStart,e=0,g=[],d;g.length=a;for(d=a-1;0<=d;d--)e+=\r\nthis._spiralFootSeparation/c+5E-4*d,g[d]=(new L.Point(b.x+c*Math.cos(e),b.y+c*Math.sin(e)))._round(),c+=this._2PI*this._spiralLengthFactor/e;return g}});L.MarkerCluster.include(!L.DomUtil.TRANSITION?{_animationSpiderfy:function(a,b){var c=this._group,e=c._map,g,d,f;for(g=a.length-1;0<=g;g--)f=e.layerPointToLatLng(b[g]),d=a[g],d._preSpiderfyLatlng=d._latlng,d.setLatLng(f),d.setZIndexOffset(1E6),L.FeatureGroup.prototype.addLayer.call(c,d),f=new L.Polyline([this._latlng,f],{weight:1.5,color:\"#222\"}),\r\ne.addLayer(f),d._spiderLeg=f;this.setOpacity(0.3);c.fire(\"spiderfied\")},_animationUnspiderfy:function(){var a=this._group,b=a._map,c=this.getAllChildMarkers(),e,g;this.setOpacity(1);for(g=c.length-1;0<=g;g--)e=c[g],L.FeatureGroup.prototype.removeLayer.call(a,e),e.setLatLng(e._preSpiderfyLatlng),delete e._preSpiderfyLatlng,e.setZIndexOffset(0),b.removeLayer(e._spiderLeg),delete e._spiderLeg}}:{_animationSpiderfy:function(a,b){var c=this._group,e=c._map,g=e.latLngToLayerPoint(this._latlng),d,f,i;for(d=\r\na.length-1;0<=d;d--)f=a[d],f.setZIndexOffset(1E6),f.setOpacity(0),L.FeatureGroup.prototype.addLayer.call(c,f),f._setPos(g);c._forceLayout();c._animationStart();var g=L.Browser.svg?0:0.3,k=L.Path.SVG_NS;for(d=a.length-1;0<=d;d--)if(i=e.layerPointToLatLng(b[d]),f=a[d],f._preSpiderfyLatlng=f._latlng,f.setLatLng(i),f.setOpacity(1),i=new L.Polyline([this._latlng,i],{weight:1.5,color:\"#222\",opacity:g}),e.addLayer(i),f._spiderLeg=i,L.Browser.svg){f=i._path.getTotalLength();i._path.setAttribute(\"stroke-dasharray\",\r\nf+\",\"+f);var j=document.createElementNS(k,\"animate\");j.setAttribute(\"attributeName\",\"stroke-dashoffset\");j.setAttribute(\"begin\",\"indefinite\");j.setAttribute(\"from\",f);j.setAttribute(\"to\",0);j.setAttribute(\"dur\",0.25);i._path.appendChild(j);j.beginElement();j=document.createElementNS(k,\"animate\");j.setAttribute(\"attributeName\",\"stroke-opacity\");j.setAttribute(\"attributeName\",\"stroke-opacity\");j.setAttribute(\"begin\",\"indefinite\");j.setAttribute(\"from\",0);j.setAttribute(\"to\",0.5);j.setAttribute(\"dur\",\r\n0.25);i._path.appendChild(j);j.beginElement()}this.setOpacity(0.3);if(L.Browser.svg){this._group._forceLayout();for(d=a.length-1;0<=d;d--)f=a[d]._spiderLeg,f.options.opacity=0.5,f._path.setAttribute(\"stroke-opacity\",0.5)}setTimeout(function(){c._animationEnd();c.fire(\"spiderfied\")},250)},_animationUnspiderfy:function(a){var b=this._group,c=b._map,a=a?c._latLngToNewLayerPoint(this._latlng,a.zoom,a.center):c.latLngToLayerPoint(this._latlng),e=this.getAllChildMarkers(),g=L.Browser.svg,d,f,i;b._animationStart();\r\nthis.setOpacity(1);for(f=e.length-1;0<=f;f--)d=e[f],d.setLatLng(d._preSpiderfyLatlng),delete d._preSpiderfyLatlng,d._setPos(a),d.setOpacity(0),g&&(i=d._spiderLeg._path.childNodes[0],i.setAttribute(\"to\",i.getAttribute(\"from\")),i.setAttribute(\"from\",0),i.beginElement(),i=d._spiderLeg._path.childNodes[1],i.setAttribute(\"from\",0.5),i.setAttribute(\"to\",0),i.setAttribute(\"stroke-opacity\",0),i.beginElement(),d._spiderLeg._path.setAttribute(\"stroke-opacity\",0));setTimeout(function(){var a=0;for(f=e.length-\r\n1;0<=f;f--)d=e[f],d._spiderLeg&&a++;for(f=e.length-1;0<=f;f--)d=e[f],d._spiderLeg&&(d.setOpacity(1),d.setZIndexOffset(0),1<a&&L.FeatureGroup.prototype.removeLayer.call(b,d),c.removeLayer(d._spiderLeg),delete d._spiderLeg);b._animationEnd()},250)}});L.MarkerClusterGroup.include({_spiderfied:null,_spiderfierOnAdd:function(){this._map.on(\"click\",this._unspiderfyWrapper,this);if(this._map.options.zoomAnimation)this._map.on(\"zoomstart\",this._unspiderfyZoomStart,this);else this._map.on(\"zoomend\",this._unspiderfyWrapper,\r\nthis);L.Browser.svg&&!L.Browser.touch&&this._map._initPathRoot()},_spiderfierOnRemove:function(){this._map.off(\"click\",this._unspiderfyWrapper,this);this._map.off(\"zoomstart\",this._unspiderfyZoomStart,this);this._map.off(\"zoomanim\",this._unspiderfyZoomAnim,this);this._unspiderfy()},_unspiderfyZoomStart:function(){if(this._map)this._map.on(\"zoomanim\",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(a){L.DomUtil.hasClass(this._map._mapPane,\"leaflet-touching\")||(this._map.off(\"zoomanim\",\r\nthis._unspiderfyZoomAnim,this),this._unspiderfy(a))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(a){this._spiderfied&&this._spiderfied.unspiderfy(a)},_unspiderfyLayer:function(a){a._spiderLeg&&(L.FeatureGroup.prototype.removeLayer.call(this,a),a.setOpacity(1),a.setZIndexOffset(0),this._map.removeLayer(a._spiderLeg),delete a._spiderLeg)}})})(this);(function(){L.TileLayer.Common=L.TileLayer.extend({initialize:function(a){L.TileLayer.prototype.initialize.call(this,this.url,a)}});L.TileLayer.OpenStreetMap=L.TileLayer.Common.extend({url:\"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",options:{attribution:'&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>'}});L.TileLayer.OpenStreetMap.Mapnik=L.TileLayer.OpenStreetMap;L.TileLayer.OpenStreetMap.BlackAndWhite=\r\nL.TileLayer.OpenStreetMap.extend({url:\"http://{s}.www.toolserver.org/tiles/bw-mapnik/{z}/{x}/{y}.png\"});L.TileLayer.OpenStreetMap.DE=L.TileLayer.OpenStreetMap.extend({url:\"http://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png\"});L.TileLayer.OpenCycleMap=L.TileLayer.Common.extend({url:\"http://{s}.tile.opencyclemap.org/cycle/{z}/{x}/{y}.png\",options:{attribution:'&copy; <a href=\"http://www.opencyclemap.org\">OpenCycleMap</a>, <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>'}});\r\nL.TileLayer.Thunderforest=L.TileLayer.OpenCycleMap;L.TileLayer.Thunderforest.OpenCycleMap=L.TileLayer.Thunderforest;L.TileLayer.Thunderforest.Transport=L.TileLayer.Thunderforest.extend({url:\"http://{s}.tile2.opencyclemap.org/transport/{z}/{x}/{y}.png\"});L.TileLayer.Thunderforest.Landscape=L.TileLayer.Thunderforest.extend({url:\"http://{s}.tile3.opencyclemap.org/landscape/{z}/{x}/{y}.png\"});L.TileLayer.MapQuestOpen=L.TileLayer.Common.extend({url:\"http://otile{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png\",\r\noptions:{attribution:'Tiles Courtesy of <a href=\"http://www.mapquest.com/\">MapQuest</a> &mdash; Map data &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>',subdomains:\"1234\"}});L.TileLayer.MapQuestOpen.OSM=L.TileLayer.MapQuestOpen;L.TileLayer.MapQuestOpen.Aerial=L.TileLayer.MapQuestOpen.extend({url:\"http://oatile{s}.mqcdn.com/naip/{z}/{x}/{y}.jpg\",options:{attribution:'Tiles Courtesy of <a href=\"http://www.mapquest.com/\">MapQuest</a> &mdash; Portions Courtesy NASA/JPL-Caltech and U.S. Depart. of Agriculture, Farm Service Agency'}});\r\nL.TileLayer.MapBox=L.TileLayer.Common.extend({url:\"http://{s}.tiles.mapbox.com/v3/mapbox.mapbox-simple/{z}/{x}/{y}.png\",options:{attribution:'Imagery from <a href=\"http://mapbox.com/about/maps/\">MapBox</a> &mdash; Map data &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>',subdomains:[\"a\",\"b\",\"c\",\"d\"]}});L.TileLayer.MapBox.Simple=L.TileLayer.MapBox;L.TileLayer.MapBox.Streets=L.TileLayer.MapBox.extend({url:\"http://{s}.tiles.mapbox.com/v3/mapbox.mapbox-streets/{z}/{x}/{y}.png\"});\r\nL.TileLayer.MapBox.Light=L.TileLayer.MapBox.extend({url:\"http://{s}.tiles.mapbox.com/v3/mapbox.mapbox-light/{z}/{x}/{y}.png\"});L.TileLayer.MapBox.Lacquer=L.TileLayer.MapBox.extend({url:\"http://{s}.tiles.mapbox.com/v3/mapbox.mapbox-lacquer/{z}/{x}/{y}.png\"});L.TileLayer.MapBox.Warden=L.TileLayer.MapBox.extend({url:\"http://{s}.tiles.mapbox.com/v3/mapbox.mapbox-warden/{z}/{x}/{y}.png\"});L.TileLayer.Stamen=L.TileLayer.Common.extend({url:\"http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.png\",options:{attribution:'Map tiles by <a href=\"http://stamen.com\">Stamen Design</a>, <a href=\"http://creativecommons.org/licenses/by/3.0\">CC BY 3.0</a> &mdash; Map data &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>',\r\nsubdomains:[\"a\",\"b\",\"c\",\"d\"],minZoom:0,maxZoom:20}});L.TileLayer.Stamen.Toner=L.TileLayer.Stamen;L.TileLayer.Stamen.TonerLines=L.TileLayer.Stamen.extend({url:\"http://{s}.tile.stamen.com/toner-lines/{z}/{x}/{y}.png\"});L.TileLayer.Stamen.TonerLabels=L.TileLayer.Stamen.extend({url:\"http://{s}.tile.stamen.com/toner-labels/{z}/{x}/{y}.png\"});L.TileLayer.Stamen.Terrain=L.TileLayer.Stamen.extend({url:\"http://{s}.tile.stamen.com/terrain/{z}/{x}/{y}.png\",options:{minZoom:4,maxZoom:18}});L.TileLayer.Stamen.Watercolor=\r\nL.TileLayer.Stamen.extend({url:\"http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.png\",options:{minZoom:3,maxZoom:16}});L.TileLayer.Esri=L.TileLayer.Common.extend({url:\"http://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}\",options:{attribution:\"Tiles &copy; Esri\"}});L.TileLayer.Esri.WorldStreetMap=L.TileLayer.Esri;L.TileLayer.Esri.DeLorme=L.TileLayer.Esri.extend({url:\"http://server.arcgisonline.com/ArcGIS/rest/services/Specialty/DeLorme_World_Base_Map/MapServer/tile/{z}/{y}/{x}\",\r\noptions:{attribution:\"Tiles &copy; Esri &mdash; Copyright: \\u00c2\\u00a92012 DeLorme\"}});L.TileLayer.Esri.WorldTopoMap=L.TileLayer.Esri.extend({url:\"http://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}\",options:{attribution:\"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community\"}});L.TileLayer.Esri.WorldImagery=\r\nL.TileLayer.Esri.extend({url:\"http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}\",options:{attribution:\"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community\"}});L.TileLayer.Esri.OceanBasemap=L.TileLayer.Esri.extend({url:\"http://services.arcgisonline.com/ArcGIS/rest/services/Ocean_Basemap/MapServer/tile/{z}/{y}/{x}\",options:{attribution:\"Tiles &copy; Esri &mdash; Sources: GEBCO, NOAA, CHS, OSU, UNH, CSUMB, National Geographic, DeLorme, NAVTEQ, and Esri\"}});\r\nL.TileLayer.Esri.NatGeoWorldMap=L.TileLayer.Esri.extend({url:\"http://services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}\",options:{attribution:\"Tiles &copy; Esri &mdash; National Geographic, Esri, DeLorme, NAVTEQ, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, iPC\"}})})();var BIKE,HSIP,PED,TOP200,bZ,baseLayers,cL,chMap,changeLayer,defaultLayer,filter,gMarker,geocode,h,hZ,m,oef,old,pBIKE,pHSIP,pPED,pTOP200,pZ,parseJSON,parsePoly,rZ,resetgeo,rmAll,z;\r\n$(function(){$(\"#tabs\").tabs({collapsible:!0,selected:-1});return $(\"input:submit,input:reset\").button()});m=new L.Map(\"map\",{center:new L.LatLng(42.2,-71),zoom:8,attributionControl:!0});h=new L.Hash(m);defaultLayer=new L.TileLayer.MapQuestOpen.OSM;m.addLayer(defaultLayer);oef=function(a,b){return b.bindPopup(\"Crash Count: \"+a.properties.CrashCount+\"<br/>EPDO: \"+a.properties.EPDO+\"<br/>FATAL: \"+a.properties.FATAL+\"<br/>INJURY: \"+a.properties.INJURY+\"<br/>NONINJ: \"+a.properties.NONINJ+a.properties.RANK)};\r\nfilter={HSIP:function(a){return\"HSIP\"===a.properties.Map},BIKE:function(a){return\"BIKE\"===a.properties.Map},PED:function(a){return\"PED\"===a.properties.Map},RANK:function(a){return\"HSIP\"===a.properties.Map&&0<a.properties.RANK}};HSIP=new L.MarkerClusterGroup;BIKE=new L.MarkerClusterGroup;PED=new L.MarkerClusterGroup;TOP200=new L.MarkerClusterGroup;pHSIP=L.geoJson(\"\",{onEachFeature:oef,filter:filter.HSIP});pBIKE=L.geoJson(\"\",{onEachFeature:oef,filter:filter.BIKE});\r\npPED=L.geoJson(\"\",{onEachFeature:oef,filter:filter.PED});pTOP200=L.geoJson(\"\",{onEachFeature:oef,filter:filter.RANK});baseLayers={\"OpenStreetMap Default\":new L.TileLayer.OpenStreetMap.Mapnik,\"OpenStreetMap German Style\":new L.TileLayer.OpenStreetMap.DE,\"MapQuest OSM\":defaultLayer};m.addControl(L.control.layers(baseLayers,\"\",{collapsed:!1}));\r\nparseJSON=function(a){return $.each(a.features,function(a,c){var e;e=new L.Marker([c.geometry.coordinates[1],c.geometry.coordinates[0]],{title:c.properties.GroupCode});e.bindPopup(\"Crash Count: \"+c.properties.CrashCount+\"<br/>EPDO: \"+c.properties.EPDO+\"<br/>FATAL: \"+c.properties.FATAL+\"<br/>INJURY: \"+c.properties.INJURY+\"<br/>NONINJ: \"+c.properties.NONINJ+\"<br/>RANK: \"+c.properties.RANK);\"HSIP\"===c.properties.Map&&HSIP.addLayer(e);\"BIKE\"===c.properties.Map&&BIKE.addLayer(e);\"PED\"===c.properties.Map&&\r\nPED.addLayer(e);if(\"HSIP\"===c.properties.Map&&0<c.properties.RANK)return TOP200.addLayer(e)})};parsePoly=function(a){pHSIP.addData(a);pBIKE.addData(a);pPED.addData(a);return pTOP200.addData(a)};$.get(\"point.json\",parseJSON);$.get(\"poly-simp.json\",parsePoly);bZ=function(){var a;a=m.getZoom();if(14<a){if(m.hasLayer(BIKE)&&m.removeLayer(BIKE),!m.hasLayer(pBIKE))return m.addLayer(pBIKE)}else if(14>=a&&(m.hasLayer(pBIKE)&&m.removeLayer(pBIKE),!m.hasLayer(BIKE)))return m.addLayer(BIKE)};\r\npZ=function(){var a;a=m.getZoom();if(14<a){if(m.hasLayer(PED)&&m.removeLayer(PED),!m.hasLayer(pPED))return m.addLayer(pPED)}else if(14>=a&&(m.hasLayer(pPED)&&m.removeLayer(pPED),!m.hasLayer(PED)))return m.addLayer(PED)};hZ=function(){var a;a=m.getZoom();if(14<a){if(m.hasLayer(HSIP)&&m.removeLayer(HSIP),!m.hasLayer(pHSIP))return m.addLayer(pHSIP)}else if(14>=a&&(m.hasLayer(pHSIP)&&m.removeLayer(pHSIP),!m.hasLayer(HSIP)))return m.addLayer(HSIP)};\r\nrZ=function(){var a;a=m.getZoom();if(14<a){if(m.hasLayer(TOP200)&&m.removeLayer(TOP200),!m.hasLayer(pTOP200))return m.addLayer(pTOP200)}else if(14>=a&&(m.hasLayer(pTOP200)&&m.removeLayer(pTOP200),!m.hasLayer(TOP200)))return m.addLayer(TOP200)};cL=\"HSIP\";hZ();"]],"start1":0,"start2":0,"length1":0,"length2":34212}]],"length":34212,"saved":false}
{"ts":1349275204036,"patch":[[{"diffs":[[-1,"(function(a){var b,c=a.documentMode;b=\"onhashchange\"in a&&(void 0===c||7<c);L.Hash=function(a){this.onHashChange=L.Util.bind(this.onHashChange,this);a&&this.init(a)};L.Hash.prototype={map:null,lastHash:null,parseHash:function(a){0==a.indexOf(\"#\")&&(a=a.substr(1));var b=a.split(\"/\");if(3==b.length){var a=parseInt(b[0],10),c=parseFloat(b[1]),b=parseFloat(b[2]);return isNaN(a)||isNaN(c)||isNaN(b)?!1:{center:new L.LatLng(c,b),zoom:a}}return!1},formatHash:function(a){var b=a.getCenter(),a=a.getZoom(),\r\nc=Math.max(0,Math.ceil(Math.log(a)/Math.LN2));return\"#\"+[a,b.lat.toFixed(c),b.lng.toFixed(c)].join(\"/\")},init:function(a){this.map=a;this.map.on(\"moveend\",this.onMapMove,this);this.lastHash=null;this.onHashChange();this.isListening||this.startListening()},remove:function(){this.map=null;this.isListening&&this.stopListening()},onMapMove:function(){if(this.movingMap||0===this.map.getZoom())return!1;var a=this.formatHash(this.map);this.lastHash!=a&&(location.replace(a),this.lastHash=a)},movingMap:!1,\r\nupdate:function(){var a=location.hash;if(a!==this.lastHash)if(a=this.parseHash(a))this.movingMap=!0,this.map.setView(a.center,a.zoom),this.movingMap=!1;else this.onMapMove(this.map)},changeDefer:100,changeTimeout:null,onHashChange:function(){if(!this.changeTimeout){var a=this;this.changeTimeout=setTimeout(function(){a.update();a.changeTimeout=null},this.changeDefer)}},isListening:!1,hashChangeInterval:null,startListening:function(){b?L.DomEvent.addListener(a,\"hashchange\",this.onHashChange):(clearInterval(this.hashChangeInterval),\r\nthis.hashChangeInterval=setInterval(this.onHashChange,50));this.isListening=!0},stopListening:function(){b?L.DomEvent.removeListener(a,\"hashchange\",this.onHashChange):clearInterval(this.hashChangeInterval);this.isListening=!1}}})(window);(function(){L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,skipDuplicateAddTesting:!1,animateAddingMarkers:!1},initialize:function(a){L.Util.setOptions(this,a);this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction);L.FeatureGroup.prototype.initialize.call(this,[]);this._inZoomAnimation=0;this._needsClustering=\r\n[];this._currentShownBounds=null},addLayer:function(a){if(a instanceof L.LayerGroup){for(var b in a._layers)a._layers.hasOwnProperty(b)&&this.addLayer(a._layers[b]);return this}this.options.singleMarkerMode&&(a.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[a]}}));if(!this._map)return this._needsClustering.push(a),this;if(!this.options.skipDuplicateAddTesting&&this.hasLayer(a))return this;this._unspiderfy&&this._unspiderfy();this._addLayer(a,\r\nthis._maxZoom);b=a;var c=this._map.getZoom();if(a.__parent)for(;b.__parent._zoom>=c;)b=b.__parent;this.options.animateAddingMarkers?this._animationAddLayer(a,b):this._animationAddLayerNonAnimated(a,b);return this},removeLayer:function(a){if(!this._map)return this._arraySplice(this._needsClustering,a),this;if(!a.__parent)return this;this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(a));this._removeLayer(a,!0);a._icon&&(L.FeatureGroup.prototype.removeLayer.call(this,a),a.setOpacity(1));return this},\r\nclearLayers:function(){if(!this._map)return this._needsClustering=[],this;this._unspiderfy&&this._unspiderfy();for(var a in this._layers)this._layers.hasOwnProperty(a)&&L.FeatureGroup.prototype.removeLayer.call(this,this._layers[a]);this._generateInitialClusters();return this},hasLayer:function(a){var b=!1;this._topClusterLevel._recursively(new L.LatLngBounds([a.getLatLng()]),0,this._map.getMaxZoom()+1,function(c){for(var e=c._markers.length-1;0<=e&&!b;e--)c._markers[e]===a&&(b=!0)},null);return b},\r\nzoomToShowLayer:function(a,b){var c=function(){if((a._icon||a.__parent._icon)&&!this._inZoomAnimation)if(this._map.off(\"moveend\",c,this),this.off(\"animationend\",c,this),a._icon)b();else if(a.__parent._icon){var e=function(){this.off(\"spiderfied\",e,this);b()};this.on(\"spiderfied\",e,this);a.__parent.spiderfy()}};a._icon?b():a.__parent._zoom<this._map.getZoom()?(this._map.on(\"moveend\",c,this),a._icon||this._map.panTo(a.getLatLng())):(this._map.on(\"moveend\",c,this),this.on(\"animationend\",c,this),this._map.setView(a.getLatLng(),\r\na.__parent._zoom+1),a.__parent.zoomToBounds())},onAdd:function(a){L.FeatureGroup.prototype.onAdd.call(this,a);this._gridClusters||this._generateInitialClusters();for(var a=0,b=this._needsClustering.length;a<b;a++)this._addLayer(this._needsClustering[a],this._maxZoom);this._needsClustering=[];this._map.on(\"zoomend\",this._zoomEnd,this);this._map.on(\"moveend\",this._moveEnd,this);this._spiderfierOnAdd&&this._spiderfierOnAdd();this._bindEvents();this._zoom=this._map.getZoom();this._currentShownBounds=\r\nthis._getExpandedVisibleBounds();this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)},onRemove:function(a){this._map.off(\"zoomend\",this._zoomEnd,this);this._map.off(\"moveend\",this._moveEnd,this);this._map._mapPane.className=this._map._mapPane.className.replace(\" leaflet-cluster-anim\",\"\");this._spiderfierOnRemove&&this._spiderfierOnRemove();L.FeatureGroup.prototype.onRemove.call(this,a)},_arraySplice:function(a,b){for(var c=a.length-1;0<=c;c--)if(a[c]===b){a.splice(c,\r\n1);break}},_removeLayer:function(a,b){var c=this._gridClusters,e=this._gridUnclustered,g=this._map;if(b)for(var d=this._maxZoom;0<=d&&e[d].removeObject(a,g.project(a.getLatLng(),d));d--);var d=a.__parent,f;for(this._arraySplice(d._markers,a);d;){d._childCount--;if(0>d._zoom)break;else b&&1>=d._childCount?(f=d._markers[0]===a?d._markers[1]:d._markers[0],c[d._zoom].removeObject(d,g.project(d._cLatLng,d._zoom)),e[d._zoom].addObject(f,g.project(f.getLatLng(),d._zoom)),this._arraySplice(d.__parent._childClusters,\r\nd),d.__parent._markers.push(f),f.__parent=d.__parent,d._icon&&(L.FeatureGroup.prototype.removeLayer.call(this,d),L.FeatureGroup.prototype.addLayer.call(this,f))):(d._recalculateBounds(),d._updateIcon());d=d.__parent}},_propagateEvent:function(a){a.target instanceof L.MarkerCluster&&(a.type=\"cluster\"+a.type);L.FeatureGroup.prototype._propagateEvent.call(this,a)},_defaultIconCreateFunction:function(a){var a=a.getChildCount(),b=\" marker-cluster-\";return new L.DivIcon({html:\"<div><span>\"+a+\"</span></div>\",\r\nclassName:\"marker-cluster\"+(10>a?b+\"small\":100>a?b+\"medium\":b+\"large\"),iconSize:new L.Point(40,40)})},_bindEvents:function(){var a=null,b=this._map,c=this.options.spiderfyOnMaxZoom,e=this.options.showCoverageOnHover,g=this.options.zoomToBoundsOnClick;if(c||g)this.on(\"clusterclick\",function(a){b.getMaxZoom()===b.getZoom()?c&&a.layer.spiderfy():g&&a.layer.zoomToBounds()},this);e&&(this.on(\"clustermouseover\",function(c){this._inZoomAnimation||(a&&b.removeLayer(a),2<c.layer.getChildCount()&&(a=new L.Polygon(c.layer.getConvexHull()),\r\nb.addLayer(a)))},this),this.on(\"clustermouseout\",function(){a&&(b.removeLayer(a),a=null)},this),b.on(\"zoomend\",function(){a&&(b.removeLayer(a),a=null)},this),b.on(\"layerremove\",function(c){a&&c.layer===this&&(b.removeLayer(a),a=null)},this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=this._map._zoom,this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var a=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,\r\nthis._zoom,a);this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,a);this._currentShownBounds=a}},_generateInitialClusters:function(){var a=this._map.getMaxZoom(),b=this.options.maxClusterRadius;this.options.disableClusteringAtZoom&&(a=this.options.disableClusteringAtZoom-1);this._maxZoom=a;this._gridClusters={};for(this._gridUnclustered={};0<=a;a--)this._gridClusters[a]=new L.DistanceGrid(b),this._gridUnclustered[a]=new L.DistanceGrid(b);this._topClusterLevel=new L.MarkerCluster(this,\r\n-1)},_addLayer:function(a,b){for(var c=this._gridClusters,e=this._gridUnclustered,g,d;0<=b;b--){g=this._map.project(a.getLatLng(),b);var f=c[b].getNearObject(g);if(f){f._addChild(a);a.__parent=f;return}if(f=e[b].getNearObject(g)){f.__parent&&this._removeLayer(f,!1);g=f.__parent;d=new L.MarkerCluster(this,b,f,a);c[b].addObject(d,this._map.project(d._cLatLng,b));f.__parent=d;var i=a.__parent=d;for(d=b-1;d>g._zoom;d--)i=new L.MarkerCluster(this,d,i),c[d].addObject(i,this._map.project(f.getLatLng(),d));\r\ng._addChild(i);for(d=b;0<=d&&e[d].removeObject(f,this._map.project(f.getLatLng(),d));d--);return}e[b].addObject(a,g)}this._topClusterLevel._addChild(a);a.__parent=this._topClusterLevel},_mergeSplitClusters:function(){this._zoom<this._map._zoom?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,this._map._zoom)):this._zoom>this._map._zoom?(this._animationStart(),this._animationZoomOut(this._zoom,\r\nthis._map._zoom)):this._moveEnd()},_getExpandedVisibleBounds:function(){var a=this._map,b=a.getPixelBounds(),c=L.Browser.mobile?0:Math.abs(b.max.x-b.min.x),e=L.Browser.mobile?0:Math.abs(b.max.y-b.min.y),g=a.unproject(new L.Point(b.min.x-c,b.min.y-e)),a=a.unproject(new L.Point(b.max.x+c,b.max.y+e));return new L.LatLngBounds(g,a)},_animationAddLayerNonAnimated:function(a,b){if(b===a)L.FeatureGroup.prototype.addLayer.call(this,a);else if(2===b._childCount){b._addToMap();var c=b.getAllChildMarkers();\r\nL.FeatureGroup.prototype.removeLayer.call(this,c[0]);L.FeatureGroup.prototype.removeLayer.call(this,c[1])}else b._updateIcon()}});L.MarkerClusterGroup.include(!L.DomUtil.TRANSITION?{_animationStart:function(){},_animationZoomIn:function(a,b){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,a);this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds())},_animationZoomOut:function(a,b){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,\r\na);this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds())},_animationAddLayer:function(a,b){this._animationAddLayerNonAnimated(a,b)}}:{_animationStart:function(){this._map._mapPane.className+=\" leaflet-cluster-anim\";this._inZoomAnimation++},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(\" leaflet-cluster-anim\",\"\"));this._inZoomAnimation--;this.fire(\"animationend\")},_animationZoomIn:function(a,b){var c=this,\r\ne=this._getExpandedVisibleBounds(),g;this._topClusterLevel._recursively(e,a,0,function(d){var f=d._latlng,j=d._markers;d._isSingleParent()&&a+1===b?(L.FeatureGroup.prototype.removeLayer.call(c,d),d._recursivelyAddChildrenToMap(null,b,e)):(d.setOpacity(0),d._recursivelyAddChildrenToMap(f,b,e));for(g=j.length-1;0<=g;g--)d=j[g],e.contains(d._latlng)||L.FeatureGroup.prototype.removeLayer.call(c,d)});this._forceLayout();var d,f;c._topClusterLevel._recursivelyBecomeVisible(e,b);for(d in c._layers)c._layers.hasOwnProperty(d)&&\r\n(f=c._layers[d],!(f instanceof L.MarkerCluster)&&f._icon&&f.setOpacity(1));c._topClusterLevel._recursively(e,a,b,function(a){a._recursivelyRestoreChildPositions(b)});setTimeout(function(){c._topClusterLevel._recursively(e,a,0,function(a){L.FeatureGroup.prototype.removeLayer.call(c,a);a.setOpacity(1)});c._animationEnd()},250)},_animationZoomOut:function(a,b){this._animationZoomOutSingle(this._topClusterLevel,a-1,b);this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds());\r\nthis._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,a,this._getExpandedVisibleBounds())},_animationZoomOutSingle:function(a,b,c){var e=this._getExpandedVisibleBounds();a._recursivelyAnimateChildrenInAndAddSelfToMap(e,b+1,c);var g=this;this._forceLayout();a._recursivelyBecomeVisible(e,c);setTimeout(function(){if(1===a._childCount){var d=a._markers[0];d.setLatLng(d.getLatLng());d.setOpacity(1)}else a._recursively(e,c,0,function(a){a._recursivelyRemoveChildrenFromMap(e,b+\r\n1)}),g._animationEnd()},250)},_animationAddLayer:function(a,b){var c=this;L.FeatureGroup.prototype.addLayer.call(this,a);b!==a&&(2<b._childCount?(b._updateIcon(),this._forceLayout(),this._animationStart(),a._setPos(this._map.latLngToLayerPoint(b.getLatLng())),a.setOpacity(0),setTimeout(function(){L.FeatureGroup.prototype.removeLayer.call(c,a);a.setOpacity(1);c._animationEnd()},250)):(this._forceLayout(),c._animationStart(),c._animationZoomOutSingle(b,this._map.getMaxZoom(),this._map.getZoom())))},\r\n_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}});L.MarkerCluster=L.Marker.extend({initialize:function(a,b,c,e){L.Marker.prototype.initialize.call(this,c?c._cLatLng||c.getLatLng():new L.LatLng(0,0),{icon:this});this._group=a;this._zoom=b;this._markers=[];this._childClusters=[];this._childCount=0;this._iconNeedsUpdate=!0;this._bounds=new L.LatLngBounds;c&&this._addChild(c);e&&this._addChild(e)},getAllChildMarkers:function(a){for(var a=a||[],b=this._childClusters.length-1;0<=b;b--)this._childClusters[b].getAllChildMarkers(a);\r\nfor(b=this._markers.length-1;0<=b;b--)a.push(this._markers[b]);return a},getChildCount:function(){return this._childCount},zoomToBounds:function(){this._group._map.fitBounds(this._bounds)},_updateIcon:function(){this._iconNeedsUpdate=!0;this._icon&&this.setIcon(this)},createIcon:function(){this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1);return this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(a,\r\nb){this._iconNeedsUpdate=!0;this._expandBounds(a);a instanceof L.MarkerCluster?(b||(this._childClusters.push(a),a.__parent=this),this._childCount+=a._childCount):(b||this._markers.push(a),this._childCount++);this.__parent&&this.__parent._addChild(a,!0)},_expandBounds:function(a){var b,c=a._wLatLng||a._latlng;a instanceof L.MarkerCluster?(this._bounds.extend(a._bounds),b=a._childCount):(this._bounds.extend(c),b=1);this._cLatLng||(this._cLatLng=a._cLatLng||c);a=this._childCount+b;this._wLatLng?(this._wLatLng.lat=\r\n(c.lat*b+this._wLatLng.lat*this._childCount)/a,this._wLatLng.lng=(c.lng*b+this._wLatLng.lng*this._childCount)/a):this._latlng=this._wLatLng=new L.LatLng(c.lat,c.lng)},_addToMap:function(a){a&&(this._backupLatlng=this._latlng,this.setLatLng(a));L.FeatureGroup.prototype.addLayer.call(this._group,this)},_recursivelyAnimateChildrenIn:function(a,b,c){this._recursively(a,0,c-1,function(a){var a=a._markers,c,d;for(c=a.length-1;0<=c;c--)d=a[c],d._icon&&(d._setPos(b),d.setOpacity(0))},function(a){var a=a._childClusters,\r\nc,d;for(c=a.length-1;0<=c;c--)d=a[c],d._icon&&(d._setPos(b),d.setOpacity(0))})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(a,b,c){this._recursively(a,c,0,function(e){e._recursivelyAnimateChildrenIn(a,e._group._map.latLngToLayerPoint(e.getLatLng()).round(),b);e._isSingleParent()&&b-1===c?(e.setOpacity(1),e._recursivelyRemoveChildrenFromMap(a,b)):e.setOpacity(0);e._addToMap()})},_recursivelyBecomeVisible:function(a,b){this._recursively(a,0,b,null,function(a){a.setOpacity(1)})},_recursivelyAddChildrenToMap:function(a,\r\nb,c){this._recursively(c,-1,b,function(e){if(b!==e._zoom)for(var g=e._markers.length-1;0<=g;g--){var d=e._markers[g];c.contains(d._latlng)&&(a&&(d._backupLatlng=d.getLatLng(),d.setLatLng(a),d.setOpacity(0)),L.FeatureGroup.prototype.addLayer.call(e._group,d))}},function(b){b._addToMap(a)})},_recursivelyRestoreChildPositions:function(a){for(var b=this._markers.length-1;0<=b;b--){var c=this._markers[b];c._backupLatlng&&(c.setLatLng(c._backupLatlng),delete c._backupLatlng)}if(a-1===this._zoom)for(a=this._childClusters.length-\r\n1;0<=a;a--)this._childClusters[a]._restorePosition();else for(b=this._childClusters.length-1;0<=b;b--)this._childClusters[b]._recursivelyRestoreChildPositions(a)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(a,b,c){var e,g;this._recursively(a,-1,b-1,function(a){for(g=a._markers.length-1;0<=g;g--)if(e=a._markers[g],!c||!c.contains(e._latlng))L.FeatureGroup.prototype.removeLayer.call(a._group,\r\ne),e.setOpacity(1)},function(a){for(g=a._childClusters.length-1;0<=g;g--)if(e=a._childClusters[g],!c||!c.contains(e._latlng))L.FeatureGroup.prototype.removeLayer.call(a._group,e),e.setOpacity(1)})},_recursively:function(a,b,c,e,g){var d=this._childClusters,f=this._zoom,i;if(b>f)for(f=d.length-1;0<=f;f--)i=d[f],a.intersects(i._bounds)&&i._recursively(a,b,c,e,g);else if(e&&e(this),g&&this._zoom===c&&g(this),c>f)for(f=d.length-1;0<=f;f--)i=d[f],a.intersects(i._bounds)&&i._recursively(a,b,c,e,g)},_recalculateBounds:function(){var a=\r\nthis._markers,b=this._childClusters,c;this._bounds=new L.LatLngBounds;delete this._wLatLng;for(c=a.length-1;0<=c;c--)this._expandBounds(a[c]);for(c=b.length-1;0<=c;c--)this._expandBounds(b[c])},_isSingleParent:function(){return 0<this._childClusters.length&&this._childClusters[0]._childCount===this._childCount}});L.DistanceGrid=function(a){this._cellSize=a;this._sqCellSize=a*a;this._grid={};this._objectPoint={}};L.DistanceGrid.prototype={addObject:function(a,b){var c=this._getCoord(b.x),e=this._getCoord(b.y),\r\ng=this._grid,e=g[e]=g[e]||{},c=e[c]=e[c]||[],e=L.Util.stamp(a);this._objectPoint[e]=b;c.push(a)},updateObject:function(a,b){this.removeObject(a);this.addObject(a,b)},removeObject:function(a,b){var c=this._getCoord(b.x),e=this._getCoord(b.y),g=this._grid,e=g[e]=g[e]||{},g=e[c]=e[c]||[],d,f;delete this._objectPoint[L.Util.stamp(a)];d=0;for(f=g.length;d<f;d++)if(g[d]===a)return g.splice(d,1),1===f&&delete e[c],!0},eachObject:function(a,b){var c,e,g,d,f,i,k,j=this._grid;for(c in j)if(j.hasOwnProperty(c))for(e in f=\r\nj[c],f)if(f.hasOwnProperty(e)){i=f[e];g=0;for(d=i.length;g<d;g++)if(k=a.call(b,i[g]))g--,d--}},getNearObject:function(a){var b=this._getCoord(a.x),c=this._getCoord(a.y),e,g,d,f,i,k,j,l,q=this._objectPoint,n=this._sqCellSize,p=null;for(e=c-1;e<=c+1;e++)if(f=this._grid[e])for(g=b-1;g<=b+1;g++)if(i=f[g]){d=0;for(k=i.length;d<k;d++)j=i[d],l=this._sqDist(q[L.Util.stamp(j)],a),l<n&&(n=l,p=j)}return p},_getCoord:function(a){return Math.floor(a/this._cellSize)},_sqDist:function(a,b){var c=b.x-a.x,e=b.y-a.y;\r\nreturn c*c+e*e}};L.QuickHull={getDistant:function(a,b){return(b[0].lng-b[1].lng)*(a.lat-b[0].lat)+(b[1].lat-b[0].lat)*(a.lng-b[0].lng)},findMostDistantPointFromBaseLine:function(a,b){var c=0,e=null,g=[],d,f,i;for(d=b.length-1;0<=d;d--)f=b[d],i=this.getDistant(f,a),0<i&&(g.push(f),i>c&&(c=i,e=f));return{maxPoint:e,newPoints:g}},buildConvexHull:function(a,b){var c=[],e=this.findMostDistantPointFromBaseLine(a,b);return e.maxPoint?(c=c.concat(this.buildConvexHull([a[0],e.maxPoint],e.newPoints)),c=c.concat(this.buildConvexHull([e.maxPoint,\r\na[1]],e.newPoints))):[a]},getConvexHull:function(a){var b=!1,c=!1,e=null,g=null,d;for(d=a.length-1;0<=d;d--){var f=a[d];if(!1===b||f.lat>b)e=f,b=f.lat;if(!1===c||f.lat<c)g=f,c=f.lat}return[].concat(this.buildConvexHull([g,e],a),this.buildConvexHull([e,g],a))}};L.MarkerCluster.include({getConvexHull:function(){var a=this.getAllChildMarkers(),b=[],c=[],e,g;for(g=a.length-1;0<=g;g--)e=a[g].getLatLng(),b.push(e);a=L.QuickHull.getConvexHull(b);for(g=a.length-1;0<=g;g--)c.push(a[g][0]);return c}});L.MarkerCluster.include({_2PI:2*\r\nMath.PI,_circleFootSeparation:25,_circleStartAngle:Math.PI/6,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(!(this._group._spiderfied===this||this._group._inZoomAnimation)){var a=this.getAllChildMarkers(),b=this._group._map.latLngToLayerPoint(this._latlng);this._group._unspiderfy();this._group._spiderfied=this;a.length>=this._circleSpiralSwitchover?b=this._generatePointsSpiral(a.length,b):(b.y+=10,b=this._generatePointsCircle(a.length,\r\nb));this._animationSpiderfy(a,b)}},unspiderfy:function(a){this._group._inZoomAnimation||(this._animationUnspiderfy(a),this._group._spiderfied=null)},_generatePointsCircle:function(a,b){var c=this._circleFootSeparation*(2+a)/this._2PI,e=this._2PI/a,g=[],d,f;g.length=a;for(d=a-1;0<=d;d--)f=this._circleStartAngle+d*e,g[d]=(new L.Point(b.x+c*Math.cos(f),b.y+c*Math.sin(f)))._round();return g},_generatePointsSpiral:function(a,b){var c=this._spiralLengthStart,e=0,g=[],d;g.length=a;for(d=a-1;0<=d;d--)e+=\r\nthis._spiralFootSeparation/c+5E-4*d,g[d]=(new L.Point(b.x+c*Math.cos(e),b.y+c*Math.sin(e)))._round(),c+=this._2PI*this._spiralLengthFactor/e;return g}});L.MarkerCluster.include(!L.DomUtil.TRANSITION?{_animationSpiderfy:function(a,b){var c=this._group,e=c._map,g,d,f;for(g=a.length-1;0<=g;g--)f=e.layerPointToLatLng(b[g]),d=a[g],d._preSpiderfyLatlng=d._latlng,d.setLatLng(f),d.setZIndexOffset(1E6),L.FeatureGroup.prototype.addLayer.call(c,d),f=new L.Polyline([this._latlng,f],{weight:1.5,color:\"#222\"}),\r\ne.addLayer(f),d._spiderLeg=f;this.setOpacity(0.3);c.fire(\"spiderfied\")},_animationUnspiderfy:function(){var a=this._group,b=a._map,c=this.getAllChildMarkers(),e,g;this.setOpacity(1);for(g=c.length-1;0<=g;g--)e=c[g],L.FeatureGroup.prototype.removeLayer.call(a,e),e.setLatLng(e._preSpiderfyLatlng),delete e._preSpiderfyLatlng,e.setZIndexOffset(0),b.removeLayer(e._spiderLeg),delete e._spiderLeg}}:{_animationSpiderfy:function(a,b){var c=this._group,e=c._map,g=e.latLngToLayerPoint(this._latlng),d,f,i;for(d=\r\na.length-1;0<=d;d--)f=a[d],f.setZIndexOffset(1E6),f.setOpacity(0),L.FeatureGroup.prototype.addLayer.call(c,f),f._setPos(g);c._forceLayout();c._animationStart();var g=L.Browser.svg?0:0.3,k=L.Path.SVG_NS;for(d=a.length-1;0<=d;d--)if(i=e.layerPointToLatLng(b[d]),f=a[d],f._preSpiderfyLatlng=f._latlng,f.setLatLng(i),f.setOpacity(1),i=new L.Polyline([this._latlng,i],{weight:1.5,color:\"#222\",opacity:g}),e.addLayer(i),f._spiderLeg=i,L.Browser.svg){f=i._path.getTotalLength();i._path.setAttribute(\"stroke-dasharray\",\r\nf+\",\"+f);var j=document.createElementNS(k,\"animate\");j.setAttribute(\"attributeName\",\"stroke-dashoffset\");j.setAttribute(\"begin\",\"indefinite\");j.setAttribute(\"from\",f);j.setAttribute(\"to\",0);j.setAttribute(\"dur\",0.25);i._path.appendChild(j);j.beginElement();j=document.createElementNS(k,\"animate\");j.setAttribute(\"attributeName\",\"stroke-opacity\");j.setAttribute(\"attributeName\",\"stroke-opacity\");j.setAttribute(\"begin\",\"indefinite\");j.setAttribute(\"from\",0);j.setAttribute(\"to\",0.5);j.setAttribute(\"dur\",\r\n0.25);i._path.appendChild(j);j.beginElement()}this.setOpacity(0.3);if(L.Browser.svg){this._group._forceLayout();for(d=a.length-1;0<=d;d--)f=a[d]._spiderLeg,f.options.opacity=0.5,f._path.setAttribute(\"stroke-opacity\",0.5)}setTimeout(function(){c._animationEnd();c.fire(\"spiderfied\")},250)},_animationUnspiderfy:function(a){var b=this._group,c=b._map,a=a?c._latLngToNewLayerPoint(this._latlng,a.zoom,a.center):c.latLngToLayerPoint(this._latlng),e=this.getAllChildMarkers(),g=L.Browser.svg,d,f,i;b._animationStart();\r\nthis.setOpacity(1);for(f=e.length-1;0<=f;f--)d=e[f],d.setLatLng(d._preSpiderfyLatlng),delete d._preSpiderfyLatlng,d._setPos(a),d.setOpacity(0),g&&(i=d._spiderLeg._path.childNodes[0],i.setAttribute(\"to\",i.getAttribute(\"from\")),i.setAttribute(\"from\",0),i.beginElement(),i=d._spiderLeg._path.childNodes[1],i.setAttribute(\"from\",0.5),i.setAttribute(\"to\",0),i.setAttribute(\"stroke-opacity\",0),i.beginElement(),d._spiderLeg._path.setAttribute(\"stroke-opacity\",0));setTimeout(function(){var a=0;for(f=e.length-\r\n1;0<=f;f--)d=e[f],d._spiderLeg&&a++;for(f=e.length-1;0<=f;f--)d=e[f],d._spiderLeg&&(d.setOpacity(1),d.setZIndexOffset(0),1<a&&L.FeatureGroup.prototype.removeLayer.call(b,d),c.removeLayer(d._spiderLeg),delete d._spiderLeg);b._animationEnd()},250)}});L.MarkerClusterGroup.include({_spiderfied:null,_spiderfierOnAdd:function(){this._map.on(\"click\",this._unspiderfyWrapper,this);if(this._map.options.zoomAnimation)this._map.on(\"zoomstart\",this._unspiderfyZoomStart,this);else this._map.on(\"zoomend\",this._unspiderfyWrapper,\r\nthis);L.Browser.svg&&!L.Browser.touch&&this._map._initPathRoot()},_spiderfierOnRemove:function(){this._map.off(\"click\",this._unspiderfyWrapper,this);this._map.off(\"zoomstart\",this._unspiderfyZoomStart,this);this._map.off(\"zoomanim\",this._unspiderfyZoomAnim,this);this._unspiderfy()},_unspiderfyZoomStart:function(){if(this._map)this._map.on(\"zoomanim\",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(a){L.DomUtil.hasClass(this._map._mapPane,\"leaflet-touching\")||(this._map.off(\"zoomanim\",\r\nthis._unspiderfyZoomAnim,this),this._unspiderfy(a))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(a){this._spiderfied&&this._spiderfied.unspiderfy(a)},_unspiderfyLayer:function(a){a._spiderLeg&&(L.FeatureGroup.prototype.removeLayer.call(this,a),a.setOpacity(1),a.setZIndexOffset(0),this._map.removeLayer(a._spiderLeg),delete a._spiderLeg)}})})(this);(function(){L.TileLayer.Common=L.TileLayer.extend({initialize:function(a){L.TileLayer.prototype.initialize.call(this,this.url,a)}});L.TileLayer.OpenStreetMap=L.TileLayer.Common.extend({url:\"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",options:{attribution:'&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>'}});L.TileLayer.OpenStreetMap.Mapnik=L.TileLayer.OpenStreetMap;L.TileLayer.OpenStreetMap.BlackAndWhite=\r\nL.TileLayer.OpenStreetMap.extend({url:\"http://{s}.www.toolserver.org/tiles/bw-mapnik/{z}/{x}/{y}.png\"});L.TileLayer.OpenStreetMap.DE=L.TileLayer.OpenStreetMap.extend({url:\"http://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png\"});L.TileLayer.OpenCycleMap=L.TileLayer.Common.extend({url:\"http://{s}.tile.opencyclemap.org/cycle/{z}/{x}/{y}.png\",options:{attribution:'&copy; <a href=\"http://www.opencyclemap.org\">OpenCycleMap</a>, <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>'}});\r\nL.TileLayer.Thunderforest=L.TileLayer.OpenCycleMap;L.TileLayer.Thunderforest.OpenCycleMap=L.TileLayer.Thunderforest;L.TileLayer.Thunderforest.Transport=L.TileLayer.Thunderforest.extend({url:\"http://{s}.tile2.opencyclemap.org/transport/{z}/{x}/{y}.png\"});L.TileLayer.Thunderforest.Landscape=L.TileLayer.Thunderforest.extend({url:\"http://{s}.tile3.opencyclemap.org/landscape/{z}/{x}/{y}.png\"});L.TileLayer.MapQuestOpen=L.TileLayer.Common.extend({url:\"http://otile{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png\",\r\noptions:{attribution:'Tiles Courtesy of <a href=\"http://www.mapquest.com/\">MapQuest</a> &mdash; Map data &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>',subdomains:\"1234\"}});L.TileLayer.MapQuestOpen.OSM=L.TileLayer.MapQuestOpen;L.TileLayer.MapQuestOpen.Aerial=L.TileLayer.MapQuestOpen.extend({url:\"http://oatile{s}.mqcdn.com/naip/{z}/{x}/{y}.jpg\",options:{attribution:'Tiles Courtesy of <a href=\"http://www.mapquest.com/\">MapQuest</a> &mdash; Portions Courtesy NASA/JPL-Caltech and U.S. Depart. of Agriculture, Farm Service Agency'}});\r\nL.TileLayer.MapBox=L.TileLayer.Common.extend({url:\"http://{s}.tiles.mapbox.com/v3/mapbox.mapbox-simple/{z}/{x}/{y}.png\",options:{attribution:'Imagery from <a href=\"http://mapbox.com/about/maps/\">MapBox</a> &mdash; Map data &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>',subdomains:[\"a\",\"b\",\"c\",\"d\"]}});L.TileLayer.MapBox.Simple=L.TileLayer.MapBox;L.TileLayer.MapBox.Streets=L.TileLayer.MapBox.extend({url:\"http://{s}.tiles.mapbox.com/v3/mapbox.mapbox-streets/{z}/{x}/{y}.png\"});\r\nL.TileLayer.MapBox.Light=L.TileLayer.MapBox.extend({url:\"http://{s}.tiles.mapbox.com/v3/mapbox.mapbox-light/{z}/{x}/{y}.png\"});L.TileLayer.MapBox.Lacquer=L.TileLayer.MapBox.extend({url:\"http://{s}.tiles.mapbox.com/v3/mapbox.mapbox-lacquer/{z}/{x}/{y}.png\"});L.TileLayer.MapBox.Warden=L.TileLayer.MapBox.extend({url:\"http://{s}.tiles.mapbox.com/v3/mapbox.mapbox-warden/{z}/{x}/{y}.png\"});L.TileLayer.Stamen=L.TileLayer.Common.extend({url:\"http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.png\",options:{attribution:'Map tiles by <a href=\"http://stamen.com\">Stamen Design</a>, <a href=\"http://creativecommons.org/licenses/by/3.0\">CC BY 3.0</a> &mdash; Map data &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>',\r\nsubdomains:[\"a\",\"b\",\"c\",\"d\"],minZoom:0,maxZoom:20}});L.TileLayer.Stamen.Toner=L.TileLayer.Stamen;L.TileLayer.Stamen.TonerLines=L.TileLayer.Stamen.extend({url:\"http://{s}.tile.stamen.com/toner-lines/{z}/{x}/{y}.png\"});L.TileLayer.Stamen.TonerLabels=L.TileLayer.Stamen.extend({url:\"http://{s}.tile.stamen.com/toner-labels/{z}/{x}/{y}.png\"});L.TileLayer.Stamen.Terrain=L.TileLayer.Stamen.extend({url:\"http://{s}.tile.stamen.com/terrain/{z}/{x}/{y}.png\",options:{minZoom:4,maxZoom:18}});L.TileLayer.Stamen.Watercolor=\r\nL.TileLayer.Stamen.extend({url:\"http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.png\",options:{minZoom:3,maxZoom:16}});L.TileLayer.Esri=L.TileLayer.Common.extend({url:\"http://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}\",options:{attribution:\"Tiles &copy; Esri\"}});L.TileLayer.Esri.WorldStreetMap=L.TileLayer.Esri;L.TileLayer.Esri.DeLorme=L.TileLayer.Esri.extend({url:\"http://server.arcgisonline.com/ArcGIS/rest/services/Specialty/DeLorme_World_Base_Map/MapServer/tile/{z}/{y}/{x}\",\r\noptions:{attribution:\"Tiles &copy; Esri &mdash; Copyright: \\u00c2\\u00a92012 DeLorme\"}});L.TileLayer.Esri.WorldTopoMap=L.TileLayer.Esri.extend({url:\"http://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}\",options:{attribution:\"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community\"}});L.TileLayer.Esri.WorldImagery=\r\nL.TileLayer.Esri.extend({url:\"http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}\",options:{attribution:\"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community\"}});L.TileLayer.Esri.OceanBasemap=L.TileLayer.Esri.extend({url:\"http://services.arcgisonline.com/ArcGIS/rest/services/Ocean_Basemap/MapServer/tile/{z}/{y}/{x}\",options:{attribution:\"Tiles &copy; Esri &mdash; Sources: GEBCO, NOAA, CHS, OSU, UNH, CSUMB, National Geographic, DeLorme, NAVTEQ, and Esri\"}});\r\nL.TileLayer.Esri.NatGeoWorldMap=L.TileLayer.Esri.extend({url:\"http://services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}\",options:{attribution:\"Tiles &copy; Esri &mdash; National Geographic, Esri, DeLorme, NAVTEQ, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, iPC\"}})})();var BIKE,HSIP,PED,TOP200,bZ,baseLayers,cL,chMap,changeLayer,defaultLayer,filter,gMarker,geocode,h,hZ,m,oef,old,pBIKE,pHSIP,pPED,pTOP200,pZ,parseJSON,parsePoly,rZ,resetgeo,rmAll,z;\r\n$(function(){$(\"#tabs\").tabs({collapsible:!0,selected:-1});return $(\"input:submit,input:reset\").button()});m=new L.Map(\"map\",{center:new L.LatLng(42.2,-71),zoom:8,attributionControl:!0});h=new L.Hash(m);defaultLayer=new L.TileLayer.MapQuestOpen.OSM;m.addLayer(defaultLayer);oef=function(a,b){return b.bindPopup(\"Crash Count: \"+a.properties.CrashCount+\"<br/>EPDO: \"+a.properties.EPDO+\"<br/>FATAL: \"+a.properties.FATAL+\"<br/>INJURY: \"+a.properties.INJURY+\"<br/>NONINJ: \"+a.properties.NONINJ+a.properties.RANK)};\r\nfilter={HSIP:function(a){return\"HSIP\"===a.properties.Map},BIKE:function(a){return\"BIKE\"===a.properties.Map},PED:function(a){return\"PED\"===a.properties.Map},RANK:function(a){return\"HSIP\"===a.properties.Map&&0<a.properties.RANK}};HSIP=new L.MarkerClusterGroup;BIKE=new L.MarkerClusterGroup;PED=new L.MarkerClusterGroup;TOP200=new L.MarkerClusterGroup;pHSIP=L.geoJson(\"\",{onEachFeature:oef,filter:filter.HSIP});pBIKE=L.geoJson(\"\",{onEachFeature:oef,filter:filter.BIKE});\r\npPED=L.geoJson(\"\",{onEachFeature:oef,filter:filter.PED});pTOP200=L.geoJson(\"\",{onEachFeature:oef,filter:filter.RANK});baseLayers={\"OpenStreetMap Default\":new L.TileLayer.OpenStreetMap.Mapnik,\"OpenStreetMap German Style\":new L.TileLayer.OpenStreetMap.DE,\"MapQuest OSM\":defaultLayer};m.addControl(L.control.layers(baseLayers,\"\",{collapsed:!1}));\r\nparseJSON=function(a){return $.each(a.features,function(a,c){var e;e=new L.Marker([c.geometry.coordinates[1],c.geometry.coordinates[0]],{title:c.properties.GroupCode});e.bindPopup(\"Crash Count: \"+c.properties.CrashCount+\"<br/>EPDO: \"+c.properties.EPDO+\"<br/>FATAL: \"+c.properties.FATAL+\"<br/>INJURY: \"+c.properties.INJURY+\"<br/>NONINJ: \"+c.properties.NONINJ+\"<br/>RANK: \"+c.properties.RANK);\"HSIP\"===c.properties.Map&&HSIP.addLayer(e);\"BIKE\"===c.properties.Map&&BIKE.addLayer(e);\"PED\"===c.properties.Map&&\r\nPED.addLayer(e);if(\"HSIP\"===c.properties.Map&&0<c.properties.RANK)return TOP200.addLayer(e)})};parsePoly=function(a){pHSIP.addData(a);pBIKE.addData(a);pPED.addData(a);return pTOP200.addData(a)};$.get(\"point.json\",parseJSON);$.get(\"poly-simp.json\",parsePoly);bZ=function(){var a;a=m.getZoom();if(14<a){if(m.hasLayer(BIKE)&&m.removeLayer(BIKE),!m.hasLayer(pBIKE))return m.addLayer(pBIKE)}else if(14>=a&&(m.hasLayer(pBIKE)&&m.removeLayer(pBIKE),!m.hasLayer(BIKE)))return m.addLayer(BIKE)};\r\npZ=function(){var a;a=m.getZoom();if(14<a){if(m.hasLayer(PED)&&m.removeLayer(PED),!m.hasLayer(pPED))return m.addLayer(pPED)}else if(14>=a&&(m.hasLayer(pPED)&&m.removeLayer(pPED),!m.hasLayer(PED)))return m.addLayer(PED)};hZ=function(){var a;a=m.getZoom();if(14<a){if(m.hasLayer(HSIP)&&m.removeLayer(HSIP),!m.hasLayer(pHSIP))return m.addLayer(pHSIP)}else if(14>=a&&(m.hasLayer(pHSIP)&&m.removeLayer(pHSIP),!m.hasLayer(HSIP)))return m.addLayer(HSIP)};\r\nrZ=function(){var a;a=m.getZoom();if(14<a){if(m.hasLayer(TOP200)&&m.removeLayer(TOP200),!m.hasLayer(pTOP200))return m.addLayer(pTOP200)}else if(14>=a&&(m.hasLayer(pTOP200)&&m.removeLayer(pTOP200),!m.hasLayer(TOP200)))return m.addLayer(TOP200)};cL=\"HSIP\";hZ();"],[1,"var BIKE, HSIP, PED, TOP200, bZ, baseLayers, cL, chMap, changeLayer, defaultLayer, filter, gMarker, geocode, h, hZ, m, oef, old, pBIKE, pHSIP, pPED, pTOP200, pZ, parseJSON, parsePoly, rZ, resetgeo, rmAll, z;\r\n\r\n$(function() {\r\n  $(\"#tabs\").tabs({\r\n    collapsible: true,\r\n    selected: -1\r\n  });\r\n  return $(\"input:submit,input:reset\").button();\r\n});\r\n\r\nm = new L.Map(\"map\", {\r\n  center: new L.LatLng(42.2, -71),\r\n  zoom: 8,\r\n  attributionControl: true\r\n});\r\n\r\nh = new L.Hash(m);\r\n\r\ndefaultLayer = new L.TileLayer.MapQuestOpen.OSM;\r\n\r\nm.addLayer(defaultLayer);\r\n\r\noef = function(v, l) {\r\n  return l.bindPopup(\"Crash Count: \" + v.properties.CrashCount + \"<br/>EPDO: \" + v.properties.EPDO + \"<br/>FATAL: \" + v.properties.FATAL + \"<br/>INJURY: \" + v.properties.INJURY + \"<br/>NONINJ: \" + v.properties.NONINJ + v.properties.RANK);\r\n};\r\n\r\nfilter = {\r\n  HSIP: function(v, l) {\r\n    return v.properties.Map === \"HSIP\";\r\n  },\r\n  BIKE: function(v, l) {\r\n    return v.properties.Map === \"BIKE\";\r\n  },\r\n  PED: function(v, l) {\r\n    return v.properties.Map === \"PED\";\r\n  },\r\n  RANK: function(v, l) {\r\n    return v.properties.Map === \"HSIP\" && v.properties.RANK > 0;\r\n  }\r\n};\r\n\r\nHSIP = new L.MarkerClusterGroup();\r\n\r\nBIKE = new L.MarkerClusterGroup();\r\n\r\nPED = new L.MarkerClusterGroup();\r\n\r\nTOP200 = new L.MarkerClusterGroup();\r\n\r\npHSIP = L.geoJson('', {\r\n  onEachFeature: oef,\r\n  filter: filter.HSIP\r\n});\r\n\r\npBIKE = L.geoJson('', {\r\n  onEachFeature: oef,\r\n  filter: filter.BIKE\r\n});\r\n\r\npPED = L.geoJson('', {\r\n  onEachFeature: oef,\r\n  filter: filter.PED\r\n});\r\n\r\npTOP200 = L.geoJson('', {\r\n  onEachFeature: oef,\r\n  filter: filter.RANK\r\n});\r\n\r\nbaseLayers = {\r\n  \"OpenStreetMap Default\": new L.TileLayer.OpenStreetMap.Mapnik,\r\n  \"OpenStreetMap German Style\": new L.TileLayer.OpenStreetMap.DE,\r\n  \"MapQuest OSM\": defaultLayer\r\n};\r\n\r\nm.addControl(L.control.layers(baseLayers, '', {\r\n  collapsed: false\r\n}));\r\n\r\nparseJSON = function(d) {\r\n  return $.each(d.features, function(i, v) {\r\n    var marker;\r\n    marker = new L.Marker([v.geometry.coordinates[1], v.geometry.coordinates[0]], {\r\n      title: v.properties.GroupCode\r\n    });\r\n    marker.bindPopup(\"Crash Count: \" + v.properties.CrashCount + \"<br/>EPDO: \" + v.properties.EPDO + \"<br/>FATAL: \" + v.properties.FATAL + \"<br/>INJURY: \" + v.properties.INJURY + \"<br/>NONINJ: \" + v.properties.NONINJ + \"<br/>RANK: \" + v.properties.RANK);\r\n    if (v.properties.Map === \"HSIP\") {\r\n      HSIP.addLayer(marker);\r\n    }\r\n    if (v.properties.Map === \"BIKE\") {\r\n      BIKE.addLayer(marker);\r\n    }\r\n    if (v.properties.Map === \"PED\") {\r\n      PED.addLayer(marker);\r\n    }\r\n    if (v.properties.Map === \"HSIP\" && v.properties.RANK > 0) {\r\n      return TOP200.addLayer(marker);\r\n    }\r\n  });\r\n};\r\n\r\nparsePoly = function(d) {\r\n  pHSIP.addData(d);\r\n  pBIKE.addData(d);\r\n  pPED.addData(d);\r\n  return pTOP200.addData(d);\r\n};\r\n\r\n$.get(\"point.json\", parseJSON);\r\n\r\n$.get(\"poly-simp.json\", parsePoly);\r\n\r\nbZ = function() {\r\n  var z;\r\n  z = m.getZoom();\r\n  if (z > 14) {\r\n    if (m.hasLayer(BIKE)) {\r\n      m.removeLayer(BIKE);\r\n    }\r\n    if (!m.hasLayer(pBIKE)) {\r\n      return m.addLayer(pBIKE);\r\n    }\r\n  } else if (z <= 14) {\r\n    if (m.hasLayer(pBIKE)) {\r\n      m.removeLayer(pBIKE);\r\n    }\r\n    if (!m.hasLayer(BIKE)) {\r\n      return m.addLayer(BIKE);\r\n    }\r\n  }\r\n};\r\n\r\npZ = function() {\r\n  var z;\r\n  z = m.getZoom();\r\n  if (z > 14) {\r\n    if (m.hasLayer(PED)) {\r\n      m.removeLayer(PED);\r\n    }\r\n    if (!m.hasLayer(pPED)) {\r\n      return m.addLayer(pPED);\r\n    }\r\n  } else if (z <= 14) {\r\n    if (m.hasLayer(pPED)) {\r\n      m.removeLayer(pPED);\r\n    }\r\n    if (!m.hasLayer(PED)) {\r\n      return m.addLayer(PED);\r\n    }\r\n  }\r\n};\r\n\r\nhZ = function() {\r\n  var z;\r\n  z = m.getZoom();\r\n  if (z > 14) {\r\n    if (m.hasLayer(HSIP)) {\r\n      m.removeLayer(HSIP);\r\n    }\r\n    if (!m.hasLayer(pHSIP)) {\r\n      return m.addLayer(pHSIP);\r\n    }\r\n  } else if (z <= 14) {\r\n    if (m.hasLayer(pHSIP)) {\r\n      m.removeLayer(pHSIP);\r\n    }\r\n    if (!m.hasLayer(HSIP)) {\r\n      return m.addLayer(HSIP);\r\n    }\r\n  }\r\n};\r\n\r\nrZ = function() {\r\n  var z;\r\n  z = m.getZoom();\r\n  if (z > 14) {\r\n    if (m.hasLayer(TOP200)) {\r\n      m.removeLayer(TOP200);\r\n    }\r\n    if (!m.hasLayer(pTOP200)) {\r\n      return m.addLayer(pTOP200);\r\n    }\r\n  } else if (z <= 14) {\r\n    if (m.hasLayer(pTOP200)) {\r\n      m.removeLayer(pTOP200);\r\n    }\r\n    if (!m.hasLayer(TOP200)) {\r\n      return m.addLayer(TOP200);\r\n    }\r\n  }\r\n};\r\n\r\ncL = \"HSIP\";\r\n\r\nhZ();\r\n\r\nrmAll = function() {\r\n  var z;\r\n  z = m.getZoom();\r\n  if (z <= 14) {\r\n    if (m.hasLayer(BIKE)) {\r\n      m.removeLayer(BIKE);\r\n    }\r\n    if (m.hasLayer(PED)) {\r\n      m.removeLayer(PED);\r\n    }\r\n    if (m.hasLayer(HSIP)) {\r\n      m.removeLayer(HSIP);\r\n    }\r\n    if (m.hasLayer(TOP200)) {\r\n      return m.removeLayer(TOP200);\r\n    }\r\n  } else if (z > 14) {\r\n    if (m.hasLayer(pBIKE)) {\r\n      m.removeLayer(pBIKE);\r\n    }\r\n    if (m.hasLayer(pPED)) {\r\n      m.removeLayer(pPED);\r\n    }\r\n    if (m.hasLayer(pHSIP)) {\r\n      m.removeLayer(pHSIP);\r\n    }\r\n    if (m.hasLayer(pTOP200)) {\r\n      return m.removeLayer(pTOP200);\r\n    }\r\n  }\r\n};\r\n\r\nz = function() {\r\n  if (cL === \"HSIP\") {\r\n    hZ();\r\n  }\r\n  if (cL === \"BIKE\") {\r\n    bZ();\r\n  }\r\n  if (cL === \"PED\") {\r\n    pZ();\r\n  }\r\n  if (cL === \"TOP200\") {\r\n    return rZ();\r\n  }\r\n};\r\n\r\nchangeLayer = function(l) {\r\n  rmAll();\r\n  cL = l;\r\n  return z();\r\n};\r\n\r\nm.on(\"zoomend\", z);\r\n\r\nchMap = function() {\r\n  changeLayer($(\"#getMap\").val());\r\n  return true;\r\n};\r\n\r\n$(\"#getMap\").change(chMap);\r\n\r\ngeocode = function() {\r\n  var address, gURL;\r\n  old.center = m.getCenter();\r\n  old.zoom = m.getZoom();\r\n  address = $(\"#address\").val();\r\n  gURL = \"http://open.mapquestapi.com/nominatim/v1/search?countrycodes=us&exclude_place_ids=955483008,950010827&viewbox=-76.212158203125%2C44.46123053905882%2C-66.005859375%2C40.107487419012415&bounded=1&format=json&q=\";\r\n  $.ajax({\r\n    type: \"GET\",\r\n    url: gURL + address,\r\n    dataType: \"jsonp\",\r\n    jsonp: \"json_callback\",\r\n    success: function(data, textStatus) {\r\n      var latlng;\r\n      if (textStatus === \"success\") {\r\n        latlng = new L.LatLng(data[0].lat, data[0].lon);\r\n        gMarker.setLatLng(latlng);\r\n        m.addLayer(gMarker);\r\n        return m.setView(latlng, 17);\r\n      }\r\n    }\r\n  });\r\n  return false;\r\n};\r\n\r\nresetgeo = function() {\r\n  m.removeLayer(gMarker);\r\n  return m.setView(old.center, old.zoom);\r\n};\r\n\r\ngMarker = new L.Marker();\r\n\r\nold = {};\r\n\r\n$(\"#geocoder\").submit(geocode);\r\n\r\n$(\"#resetgeo\").click(resetgeo);\r\n"]],"start1":0,"start2":0,"length1":34212,"length2":6477}]],"length":6477,"saved":false}
{"ts":1349277621679,"patch":[[{"diffs":[[0,"yer = new L."],[-1,"T"],[1,"t"],[0,"ileLayer.Map"]],"start1":492,"start2":492,"length1":25,"length2":25},{"diffs":[[0,"leLayer."],[-1,"M"],[1,"m"],[0,"apQuestO"]],"start1":506,"start2":506,"length1":17,"length2":17},{"diffs":[[0,"estOpen."],[-1,"OSM"],[1,"osm()"],[0,";\r\n\r\nm.a"]],"start1":519,"start2":519,"length1":19,"length2":21},{"diffs":[[0,"fault\": "],[-1,"new"],[0," L."],[-1,"T"],[1,"t"],[0,"ileLayer"]],"start1":1668,"start2":1668,"length1":23,"length2":20},{"diffs":[[0,"\":  L.tileLayer."],[-1,"O"],[1,"o"],[0,"penStreetMap.Map"]],"start1":1673,"start2":1673,"length1":33,"length2":33},{"diffs":[[0,"Map."],[-1,"M"],[1,"m"],[0,"apnik"],[1,"()"],[0,",\r\n "]],"start1":1699,"start2":1699,"length1":14,"length2":16},{"diffs":[[0,"e\": "],[-1,"new"],[0," L."],[-1,"T"],[1,"t"],[0,"ileL"]],"start1":1742,"start2":1742,"length1":15,"length2":12},{"diffs":[[0,"leLayer."],[-1,"O"],[1,"o"],[0,"penStree"]],"start1":1751,"start2":1751,"length1":17,"length2":17},{"diffs":[[0,"Map."],[-1,"DE"],[1,"de()"],[0,",\r\n "]],"start1":1769,"start2":1769,"length1":10,"length2":12}]],"length":6477,"saved":false}
